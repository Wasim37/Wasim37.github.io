!function(e,t){"object"===typeof exports&&"undefined"!==typeof module?t(exports,require("inferno"),require("stream")):"function"===typeof define&&define.amd?define(["exports","inferno","stream"],t):t(((e=e||self).Inferno=e.Inferno||{},e.Inferno.Server=e.Inferno.Server||{}),e.Inferno,e.stream)}(this,(function(e,t,r){"use strict";var n=Array.isArray;function o(e){return void 0===e||null===e}function u(e){return null===e||!1===e||!0===e||void 0===e}function i(e){return"function"===typeof e}function s(e){return"string"===typeof e}function a(e){return"number"===typeof e}function l(e){return null===e}function c(e){throw e||(e="a runtime error occured! Use Inferno in development environment to find the error."),new Error("Inferno Error: "+e)}function d(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}function f(e){if(s(e))return e;var t,r="";for(var n in e){var o=e[n];("string"===(t=typeof o)||"number"===t)&&(r+=n+":"+o+";")}return r}var h=new RegExp(/["'&<>]/);function p(e){if(!h.test(e))return e;var t,r="",n="",o=0;for(t=0;t<e.length;++t){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t>o&&(r+=e.slice(o,t)),r+=n,o=t+1}return r+e.slice(o,t)}var v=new RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),m={},g={};function y(e){if(void 0!==g[e])return!0;if(void 0!==m[e])return!1;if(v.test(e))return g[e]=!0,!0;return m[e]=!0,!1}var F=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function T(e,t,r){if(e.constructor.getDerivedStateFromProps)return d(r,e.constructor.getDerivedStateFromProps(t,r));return r}function x(e){return function e(r,h,v){var m=r.flags,g=r.type,x=r.props||t.EMPTY_OBJ,Q=r.children;if(0!==(14&m)){if(4&m){var S,b=new g(x,v),k=Boolean(g.getDerivedStateFromProps);if(b.$BS=!1,b.$SSR=!0,i(b.getChildContext)&&(S=b.getChildContext()),S=o(S)?v:d(v,S),b.props===t.EMPTY_OBJ&&(b.props=x),b.context=v,!k&&i(b.componentWillMount)){b.$BR=!0,b.componentWillMount(),b.$BR=!1;var C=b.$PS;if(C){var P=b.state;if(null===P)b.state=C;else for(var _ in C)P[_]=C[_];b.$PSS=!1,b.$PS=null}}k&&(b.state=T(b,x,b.state));var N=b.render(x,b.state,b.context);if(u(N))return"\x3c!--!--\x3e";if(s(N))return p(N);if(a(N))return N+"";return e(N,r,S)}var D=g(x,v);if(u(D))return"\x3c!--!--\x3e";if(s(D))return p(D);if(a(D))return D+"";return e(D,r,v)}if(0!==(481&m)){var $,w="<"+g,B=F.has(g),M=r.className;if(s(M)?w+=' class="'+p(M)+'"':a(M)&&(w+=' class="'+M+'"'),!l(x)){for(var R in x){var E=x[R];switch(R){case"dangerouslySetInnerHTML":$=E.__html;break;case"style":o(x.style)||(w+=' style="'+f(x.style)+'"');break;case"children":case"className":break;case"defaultValue":x.value||(w+=' value="'+(s(E)?p(E):E)+'"');break;case"defaultChecked":x.checked||(w+=' checked="'+E+'"');break;default:y(R)&&(s(E)?w+=" "+R+'="'+p(E)+'"':a(E)?w+=" "+R+'="'+E+'"':!0===E&&(w+=" "+R))}}"option"===g&&"undefined"!==typeof x.value&&x.value===h.props.value&&(w+=" selected")}if(B)w+=">";else{w+=">";var I=r.childFlags;if(2===I)w+=e(Q,r,v);else if(12&I)for(var A=0,V=Q.length;A<V;++A)w+=e(Q[A],r,v);else 16===I?w+=""===Q?" ":p(Q):$&&(w+=$);B||(w+="</"+g+">")}if(String(g).match(/[\s\n\/='"\0<>]/))throw w;return w}if(0!==(16&m))return""===Q?" ":p(Q);if(n(r)||0!==(8192&m)){var O=r.childFlags;if(2===O||n(r)&&0===r.length)return"\x3c!--!--\x3e";if(12&O||n(r)){for(var j=n(r)?r:Q,W="",J=0,Y=j.length;J<Y;++J)W+=e(j[J],r,v);return W}}else c();return""}(e,{},{})}var Q=function(e){function r(t){e.call(this),this.collector=[1/0],this.promises=[],this.pushQueue=this.pushQueue.bind(this),t&&this.renderVNodeToQueue(t,null,null)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype._read=function(){setTimeout(this.pushQueue,0)},r.prototype.addToQueue=function(e,t){if(o(t))"string"===typeof e&&this.collector.length-1===0?this.push(e):"string"===typeof e&&"string"===typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"===typeof this.promises[t][r]&&"string"===typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},r.prototype.pushQueue=function(){var e=this.collector[0];if("string"===typeof e)this.push(e),this.collector.shift();else if(e&&("object"===typeof e||i(e))&&i(e.then)){var t=this;e.then((function(e){var r;(r=t.collector).splice.apply(r,[0,1].concat(t.promises[e])),t.promises[e]=null,setTimeout(t.pushQueue,0)})),this.collector[0]=null}else e===1/0&&this.emit("end")},r.prototype.renderVNodeToQueue=function(e,r,h){var v=this,m=e.flags,g=e.type,x=e.props||t.EMPTY_OBJ,Q=e.children;if((14&m)>0)if(4&m){var S,b=new g(x,r),k=Boolean(g.getDerivedStateFromProps);if(b.$BS=!1,b.$SSR=!0,void 0!==b.getChildContext&&(S=b.getChildContext()),o(S)||(r=d(r,S)),b.props===t.EMPTY_OBJ&&(b.props=x),b.context=r,!k&&i(b.componentWillMount)){b.$BR=!0,b.componentWillMount();var C=b.$PS;if(C){var P=b.state;if(null===P)b.state=C;else for(var _ in C)P[_]=C[_];b.$PS=null}b.$BR=!1}if(i(b.getInitialProps)){var N=b.getInitialProps(b.props,b.context);if(N){if(Promise.resolve(N)===N){var D=this.promises.push([])-1;return void this.addToQueue(N.then((function(e){"object"===typeof e&&(b.props=d(b.props,e));var t=b.render(b.props,b.state,b.context);return u(t)?v.addToQueue("\x3c!--!--\x3e",D):s(t)?v.addToQueue(p(t),D):a(t)?v.addToQueue(t+"",D):v.renderVNodeToQueue(t,b.context,D),setTimeout(v.pushQueue,0),D})),h)}b.props=d(b.props,N)}}k&&(b.state=T(b,x,b.state));var $=b.render(b.props,b.state,b.context);u($)?this.addToQueue("\x3c!--!--\x3e",h):s($)?this.addToQueue(p($),h):a($)?this.addToQueue($+"",h):this.renderVNodeToQueue($,r,h)}else{var w=g(x,r);u(w)?this.addToQueue("\x3c!--!--\x3e",h):s(w)?this.addToQueue(p(w),h):a(w)?this.addToQueue(w+"",h):this.renderVNodeToQueue(w,r,h)}else if((481&m)>0){var B,M="<"+g,R=F.has(g),E=e.className;if(s(E)?M+=' class="'+p(E)+'"':a(E)&&(M+=' class="'+E+'"'),!l(x))for(var I in x){var A=x[I];switch(I){case"dangerouslySetInnerHTML":B=A.__html;break;case"style":o(x.style)||(M+=' style="'+f(x.style)+'"');break;case"children":case"className":break;case"defaultValue":x.value||(M+=' value="'+(s(A)?p(A):A)+'"');break;case"defaultChecked":x.checked||(M+=' checked="'+A+'"');break;default:y(I)&&(s(A)?M+=" "+I+'="'+p(A)+'"':a(A)?M+=" "+I+'="'+A+'"':!0===A&&(M+=" "+I))}}if(M+=">",String(g).match(/[\s\n\/='"\0<>]/))throw M;if(R)this.addToQueue(M,h);else{var V=e.childFlags;if(2===V)return this.addToQueue(M,h),this.renderVNodeToQueue(Q,r,h),void this.addToQueue("</"+g+">",h);if(16===V)return this.addToQueue(M,h),this.addToQueue(""===Q?" ":p(Q+""),h),void this.addToQueue("</"+g+">",h);if(12&V){this.addToQueue(M,h);for(var O=0,j=Q.length;O<j;++O)this.renderVNodeToQueue(Q[O],r,h);return void this.addToQueue("</"+g+">",h)}if(B)return void this.addToQueue(M+B+"</"+g+">",h);R||this.addToQueue(M+"</"+g+">",h)}}else if((16&m)>0)this.addToQueue(""===Q?" ":p(Q),h);else if(n(e)||0!==(8192&m)){var W=e.childFlags;if(2===W||n(e)&&0===e.length)this.addToQueue("\x3c!--!--\x3e",h);else if(12&W||n(e)){for(var J=n(e)?e:e.children,Y=0,q=J.length;Y<q;++Y)this.renderVNodeToQueue(J[Y],r,h);return}}else c()},r}(r.Readable);function S(e){return new Q(e)}var b=Promise.resolve(),k=function(e){function t(t){e.call(this),this.started=!1,this.initNode=t}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var e=this;if(this.started)return;this.started=!0,b.then((function(){return e.renderNode(e.initNode,null)})).then((function(){e.push(null)})).catch((function(t){e.emit("error",t)}))},t.prototype.renderNode=function(e,t){var r=e.flags;if((14&r)>0)return this.renderComponent(e,t,4&r);if((481&r)>0)return this.renderElement(e,t);if(n(e)||0!==(8192&r))return this.renderArrayOrFragment(e,t);return this.renderText(e)},t.prototype.renderArrayOrFragment=function(e,t){var r=this,o=e.childFlags;if(2===o||n(e)&&0===e.length)return this.push("\x3c!--!--\x3e");if(12&o||n(e))return(n(e)?e:e.children).reduce((function(e,n){return e.then((function(){return Promise.resolve(r.renderNode(n,t)).then((function(){return!!(16&n.flags)}))}))}),Promise.resolve(!1))},t.prototype.renderComponent=function(e,t,r){var n=this,l=e.type,c=e.props;if(!r){var f=l(c,t);if(u(f))return this.push("\x3c!--!--\x3e");if(s(f))return this.push(p(f));if(a(f))return this.push(f+"");return this.renderNode(f,t)}var h,v=new l(c,t),m=Boolean(l.getDerivedStateFromProps);return v.$BS=!1,v.$SSR=!0,i(v.getChildContext)&&(h=v.getChildContext()),o(h)||(t=d(t,h)),v.context=t,v.$BR=!0,Promise.resolve(!m&&v.componentWillMount&&v.componentWillMount()).then((function(){var e=v.$PS;if(e){var r=v.state;if(null===r)v.state=e;else for(var o in e)r[o]=e[o];v.$PS=null}v.$BR=!1,m&&(v.state=T(v,c,v.state));var i=v.render(v.props,v.state,v.context);if(u(i))return n.push("\x3c!--!--\x3e");if(s(i))return n.push(p(i));if(a(i))return n.push(i+"");return n.renderNode(i,t)}))},t.prototype.renderChildren=function(e,t,r){var n=this;if(2===r)return this.renderNode(e,t);if(16===r)return this.push(""===e?" ":p(e+""));if(12&r)return e.reduce((function(e,r){return e.then((function(){return Promise.resolve(n.renderNode(r,t)).then((function(){return!!(16&r.flags)}))}))}),Promise.resolve(!1))},t.prototype.renderText=function(e){this.push(""===e.children?" ":p(e.children))},t.prototype.renderElement=function(e,t){var r,n=this,u=e.type,i=e.props,c="<"+u,d=F.has(u),h=e.className;if(s(h)?c+=' class="'+p(h)+'"':a(h)&&(c+=' class="'+h+'"'),!l(i))for(var v in i){var m=i[v];switch(v){case"dangerouslySetInnerHTML":r=m.__html;break;case"style":o(i.style)||(c+=' style="'+f(i.style)+'"');break;case"children":case"className":break;case"defaultValue":i.value||(c+=' value="'+(s(m)?p(m):m)+'"');break;case"defaultChecked":i.checked||(c+=' checked="'+m+'"');break;default:if(y(v)){s(m)?c+=" "+v+'="'+p(m)+'"':a(m)?c+=" "+v+'="'+m+'"':!0===m&&(c+=" "+v);break}}}if(c+=">",this.push(c),String(u).match(/[\s\n\/='"\0<>]/))throw c;if(d)return;if(r)return this.push(r),void this.push("</"+u+">");var g=e.childFlags;if(1===g)return void this.push("</"+u+">");return Promise.resolve(this.renderChildren(e.children,t,g)).then((function(){n.push("</"+u+">")}))},t}(r.Readable);function C(e){return new k(e)}e.RenderQueueStream=Q,e.RenderStream=k,e.renderToStaticMarkup=x,e.renderToString=x,e.streamAsStaticMarkup=C,e.streamAsString=C,e.streamQueueAsStaticMarkup=S,e.streamQueueAsString=S,Object.defineProperty(e,"__esModule",{value:!0})}));
